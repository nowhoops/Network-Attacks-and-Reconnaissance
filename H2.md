# H2
## Favorite color: purple
| specs | os | vm |
|---------|-------------|--------|
| (I5/8/256) | Kali | Kali on VirtualBox |
### Time **2025-10-25 / 19:07**


## Primary Color: Purple

## Background

In this section, you don't need to read or summarize the linked articles unless specifically instructed. 

The goal of this task is to identify attack tools and avoid detection.

- Do not perform port scans on external machines. If necessary, disconnect the machines from the internet during testing. Target all attacks and port scans only to the provided practice targets. You can start the task only after accepting the course rules.

From the **Cyber Kill Chain** (image, article), we learn that the attacker is exposed to detection at every phase of the attack. Tools leave traces, which can be used to identify the attack.

When attacking, we can set up an environment in the lab that mimics a defender's system. This way, we can adjust attack tools to make them harder to detect.

In this exercise:

- Identifying the attacker's port scan
- Arm race – the attacker hides, but is it enough?
- Modify attack tools to avoid detection
- Evaluate your attack tools from two perspectives:
  - Network traffic – general approach
  - Target system logs – specific to a particular defender

Related concepts (background knowledge, no need to summarize or read fully):

- Pyramid of Pain (Bianco 2013: Pyramid of Pain)
- Cyber Kill Chain (Hutchins et al 2011: Cyber Kill Chain)
- Diamond Model (Caltagirone et al 2013: Diamond Model)
- MITRE ATT&CK (Mitre accidentally left caps lock on)

## Task Instructions

All sections require analysis and explanation. Make sure to explain the significance of the commands and command-line parameters. Explain what the results mean and what should be understood from them. Read the tips before starting.

### x) Read and briefly answer the questions. In this subtask, you do **not** need to read the articles fully or summarize them, nor perform tests on the machine.

- **Explain the concept of the Pyramid of Pain in 1-2 sentences.** (Refer to the pyramid image). [Bianco 2013: Pyramid of Pain]
- **Explain the concept of the Diamond Model in 1-2 sentences.** The author presents it quite solemnly, but you may also search for simpler articles online or jump straight to the diamond image. [Caltagirone et al 2013: Diamond Model]

### a) Apache Log
- Install the Apache web server on your local virtual machine. Browse your server over an unencrypted HTTP connection: `http://localhost`.
- Find the log entry corresponding to your page load. Analyze one such log entry, explaining all its components. (If Apache is unfamiliar to you, you can simply install it and test on the default web page. You don’t need to create your own website for this task.)

### b) Nmapped
- Perform a port scan of your web server using `localhost` and the `nmap -A` option.
- Explain the results. (Only port 80/tcp is necessary.)

### c) Scripts
- Which scripts were automatically enabled when you used the `-A` option? (This will show under the open port numbers, like `http-blah`, `http-blöh`, etc.)

### d) Traces in the Log
- Search for traces of the port scan in the web server logs (from NSE or Nmap Scripting Engine scripts in the scan). Do you find the word "nmap" in uppercase or lowercase? Explain the hits.
- What kind of searches or rules could you use to identify a port scan in another log, especially if it’s large and you can’t read all the lines?

### e) Wire Sharking
- Capture network traffic during the port scan with Wireshark. Note that `localhost` uses the "Loopback Adapter" or "lo".
- Save the `pcap` file. Search for entries that contain the word "nmap" and comment on them. You don’t need to analyze every part of each packet; a more general overview will suffice.

### f) Net Grep
- Capture network traffic with the `ngrep` command and show the entries where "nmap" appears.

### g) Agent
- Change the Nmap user-agent so that it looks like a regular web browser.

### h) Smaller Traces
- Perform the port scan again on the web server using the `localhost` address.
- Check both the Apache log and the captured network traffic. What changed when you altered the user-agent? Is the text "nmap" still present in the log?

### i) More Difficult: LoWeR ChEcK
- Remove the last instance of the "nmap" text from the script scan.
- Search for the found text in `/usr/share/nmap` and replace it with something else. Perform the port scan and ensure that "nmap" no longer appears in the Apache log or captured network traffic (both upper and lower case).
- **Note**: You may directly modify Lua scripts from `/usr/share/nmap` using `sudoedit`. Packaging the modified version is not required for this task.

### j) Optional, Difficult: Invisible, Invincible
- Search for another Nmap script that has the string "nmap" (uppercase or lowercase) in the network traffic.
- Modify Nmap’s code so that this string no longer appears in the network traffic.

## Tips

- These commands are from memory, and there may be some typos.
- **Apache Installation**:
  ```bash
  sudo apt-get update
  sudo apt-get install apache2
  sudo systemctl start apache2
