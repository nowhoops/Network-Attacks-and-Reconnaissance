# H2
## Favorite color: purple
| specs | os | vm |
|---------|-------------|--------|
| (I5/8/256) | Kali | Kali on VirtualBox |
### Time **2025-10-25 / 19:07**


## Primary Color: Purple

## Background

- The goal of this task is to identify attack tools and avoid detection.

# A)
## 1. Install Apache
sudo apt update
sudo apt upgrade -y
```bash
sudo apt install apache2 -y
```
### 2. Replace the default page
```bash
nano /var/www/html/index.html
```
- Pasted old web page that I had

### 3. Restart Apache
```bash
sudo systemctl restart apache2
```
4. Check the site from browser
<img width="699" height="643" alt="matrixwhoop" src="https://github.com/user-attachments/assets/b939c169-f4b9-4477-b876-e858af38eaf1" />

## 2. LOGs

-Find your log entry
```bash
sudo tail -n 10 /var/log/apache2/access.log

```

## Analysis of the Log Entry

| Part | Meaning |
|------|---------|
| `127.0.0.1` | Client IP address. This is the local machine (localhost). |
| `[02/Nov/2025:21:32:23 +0200]` | Date and time of the request, with timezone (+0200). |
| `"GET / HTTP/1.1"` | HTTP request line: method (GET), requested resource (`/` = homepage), and protocol (HTTP/1.1). |
| `200` | HTTP status code. 200 means the request was successful. |
| `1752` | Size of the response in bytes. The server sent 1752 bytes. |
| `"Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0"` | User-agent string. Indicates the browser (Firefox 140.0) and OS (Linux x86_64). |

---
# B) Nmap Scan Analysis
- Nmap scan
```bash
sudo nmap -A 127.0.0.1
```
- Scan results
<img width="527" height="149" alt="image" src="https://github.com/user-attachments/assets/d1404376-1101-4569-be28-08e3241c1d0f" />

| section | explanation |
|------|---------|
| `Host Status` | Host is up (0.000071s latency). |
| `Open Port` | 80/tcp open |
| `http-title:` |  whoops → The title of the webpage is “whoops”. |
| `http-server-header:` |  Apache/2.4.65 (Debian) → Confirms server type and version. |
| `OS ` | Linux 5.x | Linux 6.0 |



---
# C) script (nmap)
- -A: Enable OS detection, version detection, script scanning, and traceroute
- automatically run scripts:

<img width="365" height="30" alt="image" src="https://github.com/user-attachments/assets/3fef271c-74b8-4cbd-bc21-7912f13960a5" />
- These scripts help identify the service type, version, and basic website information automatically.



---
# D) Suspicious activity
- Finding nmap scan with


```bash
sudo cat /var/log/apache2/access.log
```
- or
```bash
sudo grep -i nse /var/log/apache2/access.log

```
<img width="935" height="843" alt="image" src="https://github.com/user-attachments/assets/2541fe72-f2cb-4b7a-8f33-f214d25afe02" />
- -i so you can find it if it is nse or NSE.
- Helps when you have large logs
- If you finde one manually. You can find others comming from the same ip.

| Field  | Description |
|------|---------|
| `127.0.0.1` | Client IP address (localhost ). |
| `[02/Nov/2025:21:32:23 +0200]` | Date and time of the request, with timezone (+0200). |
| `"GET / HTTP/1.1"` | HTTP request line: method (GET), and protocol (HTTP/1.1). |
| `200 / 181` | HTTP status code.  |
| `""Mozilla/5.0 … Nmap Scripting Engine"` | User-Agent identifying Nmap NSE scripts. |

---
# E) Wireshark

- Opened **Wireshark** with Loopback interface(lo) because I disabled my network during this H2 homework
- Start capture
- Run the nmap scan
```bash
sudo nmap -A 127.0.0.1
```
- Stop capture
- Save

-Filter with:

  ```bash
http.user_agent contains "Nmap"
```
- this shows http request where the user-agent contains "Nmap"

| Field  | Observation |
|------|---------|
| `127.0.0.1` | Client IP address (localhost ). |
| `User-Agent` |Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)\r\n


<img width="1917" height="1038" alt="image" src="https://github.com/user-attachments/assets/488a34fd-97f9-42a4-aae9-a414b8765e9f" />
- Nmaps NSe scripts leave traces
---
# F) ngrep
-scanning with ngrep

```bash
sudo ngrep -d lo -W byline port 80 | grep -i "nse"
```
- d to use looback interface
- w byline -> printting everyting as it comes
- Port 80 (what port you want to use)
- grep -i "nse" to only get answers with nse

<img width="756" height="427" alt="image" src="https://github.com/user-attachments/assets/c61c7ce8-8f27-4c5a-935f-b33572a22e85" />
---
# G) Agent
-Making my user-agent appear like a regular browser.
nmap -A --script=http-headers --script-args='http.useragent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.69 Safari/537.36"' localhost
---
# H) 
-checking the log
<img width="954" height="163" alt="image" src="https://github.com/user-attachments/assets/4a23951a-fb66-400f-8c65-80c16f11d289" />
- Now it looks like Windows running Chrome.
- Can't find nmap from user-agent
- But you can find nmap from the log
<img width="944" height="76" alt="image" src="https://github.com/user-attachments/assets/28f0ae5e-bdbd-46a7-a9e7-9b40bc084193" />
---
# I)
- Finding where nmap defines their nmaplowercheck with
```bash
 grep -Rn "nmaplowercheck" /usr/share/nmap
```
```bash
sudoedit /usr/share/nmap/nselib/http.lua 
```
- You can find the line number or with ctrl + f / find the line. 
- Change it.
- CTRL + o
- CTRL + x
- You will see it like this.
<img width="947" height="263" alt="image" src="https://github.com/user-attachments/assets/45f6ce9d-3a0b-43e4-99f7-9709e6825ba2" />



## source:
Bianco, David. 2013. *Pyramid of Pain*.  
  [https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html](https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html)

- Caltagirone, Scott, Andrew Pendergast, et al. 2013. *Diamond Model*.  
  [https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf](https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf)

- Nmap Developers. 2025. *Nmap Options Summary*.  
  [https://nmap.org/book/man-briefoptions.html](https://nmap.org/book/man-briefoptions.html)

- Mozilla Contributors. 2025. *User-Agent header*.  
  [https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/User-Agent)

- Karvinen, Tero, Lari Iso-Anttila. 2025. *Verkkoon tunkeutuminen ja tiedustelu*.  
  [https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/](https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/)

